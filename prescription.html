<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Prescriptions</title>
<style>
:root{
  --bg:#0f1221;--card:#171b33;--surface:#0c1230;--ink:#e9ecff;--muted:#aeb8ff;--line:#2b3360;
  --accent:#59f1c4;--accent-2:#7df1ff;--danger:#ff6b6b;--warn:#ffd166;--ok:#2ee59d;--radius:16px;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:
  radial-gradient(900px 600px at 110% -10%, #6ea0ff33, transparent 60%),
  radial-gradient(900px 600px at -10% 110%, #00ffc249, transparent 60%),
  var(--bg);
  color:var(--ink); font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100%}
@media (max-width:980px){.layout{grid-template-columns:1fr}}

.sidebar{display:flex;flex-direction:column;gap:14px;padding:18px;border-right:1px solid var(--line);background:#0d1430}
.brand{display:flex;align-items:center;gap:10px;font-weight:800}
.badge-logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#00211a;display:grid;place-items:center;font-weight:900;box-shadow:0 10px 18px #00ffc244}
nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:#cbd4ff;text-decoration:none;border:1px solid transparent}
nav a:hover, nav a[aria-current="page"]{background:#12193a;border-color:#2a3360;color:#fff}

.topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--line);background:#0e1634;position:sticky;top:0;z-index:2}
.search{display:flex;align-items:center;gap:10px;flex:1;max-width:600px;background:var(--surface);border:1px solid #32407a;border-radius:999px;padding:8px 12px}
.search input{border:none;outline:none;background:transparent;color:var(--ink);width:100%}
.chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2a3360;background:#0d1430;color:#cbd4ff;font-weight:600;text-decoration:none}
.logout{background:#1e2448;border:1px solid #2a3360;color:#e9ecff;padding:8px 12px;border-radius:10px;text-decoration:none}

.content{padding:20px;display:grid;gap:18px}
.card{background:color-mix(in oklab, var(--card) 92%, black);border:1px solid var(--line);border-radius:var(--radius);
  box-shadow:0 16px 30px #0006,inset 0 1px 0 #ffffff10;padding:16px}
.card h3{margin:0 0 8px;font-size:1rem;color:#cbd4ff}

.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
.pills{display:flex;gap:8px;flex-wrap:wrap}
.pill{border:1px solid #2a3360;background:#0d1430;color:#cbd4ff;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700}
.pill[aria-pressed="true"]{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#00211a;border-color:transparent}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px 8px;border-bottom:1px solid #253062;text-align:left;font-size:.95rem}
th{color:#9fb0ff;font-weight:700} tr:last-child td{border-bottom:none}
.nowrap{white-space:nowrap}
.small{font-size:.9rem;color:#b6c4ff}

.status{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:700;font-size:.85rem}
.s-ok{background:#0c2a20;color:#7bffd1;border:1px solid #134b3a}
.s-warn{background:#2b2308;color:#ffd166;border:1px solid #5e4a12}
.s-danger{background:#2b0f12;color:#ff9aa3;border:1px solid #5c1f27}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:10px;border:1px solid #2a3360;background:#141a3a;color:#e9ecff;text-decoration:none;font-weight:700}
.btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#00211a;border-color:transparent}
.actions{display:flex;gap:8px;flex-wrap:wrap}

.footer-note{color:#aeb8ff;font-size:.95rem;margin-top:8px}
</style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Main navigation">
      <div class="brand"><div class="badge-logo">UP</div><div>Unified Portal</div></div>
      <nav>
        <a href="./dashboard.html">üè† Dashboard</a>
        <a href="./prescriptions.html" aria-current="page">üíä Prescriptions</a>
        <a href="#">üóìÔ∏è Appointments</a>
        <a href="#">üí¨ Messages</a>
        <a href="#">üîî Alerts</a>
        <a href="#">‚öôÔ∏è Settings</a>
      </nav>
    </aside>

    <!-- Main -->
    <section style="display:flex;flex-direction:column;min-width:0">
      <header class="topbar">
        <form class="search" role="search">
          <input id="search" placeholder="Search medication, prescriber‚Ä¶" />
        </form>
        <div style="display:flex;gap:10px;align-items:center">
          <span id="who" class="chip">üë§ ‚Ä¶</span>
          <a id="logout" class="logout" href="#">Log out</a>
        </div>
      </header>

      <main class="content" aria-labelledby="title">
        <div class="card">
          <div class="controls">
            <div>
              <h1 id="title" style="margin:0">Prescriptions</h1>
              <div class="small">View active prescriptions, refills, and history.</div>
            </div>
            <div class="pills" role="tablist" aria-label="Filters">
              <button class="pill" data-filter="all" aria-pressed="true">All</button>
              <button class="pill" data-filter="active">Active</button>
              <button class="pill" data-filter="expiring">Expiring soon</button>
              <button class="pill" data-filter="expired">Expired</button>
            </div>
          </div>

          <table role="table" aria-label="Prescription list" id="rxTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Medication</th>
                <th>Dosage</th>
                <th>Prescriber</th>
                <th>Status</th>
                <th>Refills</th>
                <th class="nowrap">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <!-- rows injected by JS -->
            </tbody>
          </table>

          <p class="footer-note">Tip: Click ‚ÄúOrder‚Äù to simulate sending this e-prescription to a pharmacy (demo only).</p>
        </div>
      </main>
    </section>
  </div>

<script>
/* ===== Demo auth guard & personalization ===== */
const USER_KEY='UPPT_USER';
const SESSION_KEY='UPPT_SESSION';
const user = JSON.parse(localStorage.getItem(USER_KEY) || 'null');
const sess = JSON.parse(localStorage.getItem(SESSION_KEY) || 'null');
if(!user || !sess){ location.replace('./login.html'); }
document.getElementById('who').textContent = `üë§ ${user.first || 'User'} ${user.last || ''}`.trim();
document.getElementById('logout').addEventListener('click', (e)=>{ e.preventDefault(); localStorage.removeItem(SESSION_KEY); location.href='./login.html'; });

/* ===== Demo data seed ===== */
const RX_KEY='UPPT_RX';
function seed() {
  if(localStorage.getItem(RX_KEY)) return;
  const today = new Date('2025-08-17'); // demo anchor
  const addDays = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); return x; };
  const fmt = d => d.toISOString().slice(0,10);

  const data = [
    { id:'rx-001', date: fmt(addDays(today,-2)), name:'Amoxicillin', strength:'500 mg', sig:'1 tab √ó 3/day', prescriber:'Dr. Karim', refills:0,   expires: fmt(addDays(today,1))  },
    { id:'rx-002', date: fmt(addDays(today,-12)), name:'Loratadine',  strength:'10 mg',  sig:'1 tab daily',  prescriber:'Dr. Nabila', refills:2, expires: fmt(addDays(today,28)) },
    { id:'rx-003', date: fmt(addDays(today,-40)), name:'Metformin',   strength:'850 mg', sig:'1 tab √ó 2/day', prescriber:'Dr. A. Rahman', refills:1, expires: fmt(addDays(today,-5)) },
    { id:'rx-004', date: fmt(addDays(today,-1)), name:'Ibuprofen',    strength:'400 mg', sig:'PRN pain',      prescriber:'Dr. Karim', refills:1, expires: fmt(addDays(today,5)) }
  ];
  localStorage.setItem(RX_KEY, JSON.stringify(data));
}
seed();

/* ===== Render & filter ===== */
const tbody = document.getElementById('tbody');
const pills = [...document.querySelectorAll('.pill')];
const searchInput = document.getElementById('search');

function statusFor(expiresISO){
  const today = new Date();
  const exp = new Date(expiresISO + 'T00:00:00');
  const days = Math.ceil((exp - today)/(1000*60*60*24));
  if(days < 0) return {label:'Expired', cls:'s-danger'};
  if(days <= 3) return {label:'Expiring', cls:'s-warn'};
  return {label:'Active', cls:'s-ok'};
}

function human(dateISO){
  const d = new Date(dateISO+'T00:00:00');
  return d.toLocaleDateString(undefined,{month:'short',day:'numeric'});
}

function render(filter='all', query=''){
  const data = JSON.parse(localStorage.getItem(RX_KEY) || '[]');
  tbody.innerHTML = '';
  const q = query.trim().toLowerCase();

  data
   .filter(rx=>{
     const st = statusFor(rx.expiresISO || rx.expires).label.toLowerCase();
     const matchesFilter =
       filter==='all' ||
       (filter==='active'   && st==='active') ||
       (filter==='expiring' && st==='expiring') ||
       (filter==='expired'  && st==='expired');
     const matchesQuery =
       !q || [rx.name, rx.strength, rx.sig, rx.prescriber].join(' ').toLowerCase().includes(q);
     return matchesFilter && matchesQuery;
   })
   .sort((a,b)=> new Date(b.date)-new Date(a.date))
   .forEach(rx=>{
     const st = statusFor(rx.expires);
     const tr = document.createElement('tr');
     tr.innerHTML = `
       <td class="nowrap"><time datetime="${rx.date}">${human(rx.date)}</time></td>
       <td><strong>${rx.name}</strong><div class="small">${rx.sig}</div></td>
       <td>${rx.strength}</td>
       <td>${rx.prescriber}</td>
       <td><span class="status ${st.cls}">${st.label}</span></td>
       <td>${rx.refills}</td>
       <td class="nowrap">
         <div class="actions">
           <a class="btn" href="#" data-action="view" data-id="${rx.id}">View</a>
           <a class="btn" href="#" data-action="pdf" data-id="${rx.id}">Download PDF</a>
           <a class="btn primary" href="#" data-action="order" data-id="${rx.id}">Order</a>
           <a class="btn" href="#" data-action="refill" data-id="${rx.id}">Request refill</a>
         </div>
       </td>`;
     tbody.appendChild(tr);
   });
}

let currentFilter = 'all';
pills.forEach(p=>{
  p.addEventListener('click', ()=>{
    pills.forEach(x=>x.setAttribute('aria-pressed','false'));
    p.setAttribute('aria-pressed','true');
    currentFilter = p.dataset.filter;
    render(currentFilter, searchInput.value);
  });
});
searchInput.addEventListener('input', ()=> render(currentFilter, searchInput.value));

/* Action handlers (demo) */
tbody.addEventListener('click', (e)=>{
  const a = e.target.closest('a[data-action]');
  if(!a) return;
  e.preventDefault();
  const id = a.dataset.id, action = a.dataset.action;
  const rx = (JSON.parse(localStorage.getItem(RX_KEY)||'[]')).find(r=>r.id===id);
  if(!rx) return;

  if(action==='view'){
    alert(`${rx.name} ${rx.strength}\nSig: ${rx.sig}\nPrescriber: ${rx.prescriber}\nDate: ${rx.date}\nExpires: ${rx.expires}`);
  }else if(action==='pdf'){
    alert('Demo: This would download the signed e-prescription PDF.');
  }else if(action==='order'){
    alert('Demo: e-prescription sent to your preferred pharmacy.');
  }else if(action==='refill'){
    alert('Demo: Refill request sent to prescriber.');
  }
});

render(); // initial
</script>
</body>
</html>
